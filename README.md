# VYT-PIPE

Минимальный skeleton для конвейера «Вытынанка из изображения».

## Структура

```
vyt-pipe/
├─ configs/            # YAML-конфиги запусков
├─ templates/          # Заглушки шаблонов обложки/инструкций/README
├─ tools/              # Скрипты для подготовки окружения
└─ src/vyt/            # Пакет с CLI и core-модулями
```

## Быстрый старт

Быстрый запуск (PowerShell): `pwsh tools/setup_env.ps1 ; python -m vyt.cli make configs/sample.yaml`

1. Установите зависимости:
   ```powershell
   pwsh tools/setup_env.ps1
   ```
2. При желании замените входной файл: по умолчанию используется текстовый
   `input/sample.png.xbase64`, который на лету декодируется в реальный PNG.
3. Запустите CLI:
   ```bash
   python -m vyt.cli make configs/sample.yaml
   ```

CLI реализован на Typer и поддерживает команды `make`, `batch`, `qa`, `pack` (последние три пока как заглушки).

## Скрипт нарезки панелей `make_papercut_panel.py`

В корне репозитория лежит отдельный монолитный скрипт, который превращает раскраску
в печатную «вытынанку» 3×4 A4:

```bash
python make_papercut_panel.py INPUT.png \
  --output OUTPUT_BASENAME \
  --format both \
  --normalize-scale 2.0 --normalize-blur 0.8 \
  --threshold 200 --detail-delta 60 \
  --dilate-px 1 --detail-join-px 2
```

При запуске скрипт создаёт:

* `*_original.png` — панель в исходном размере (белая бумага на сером фоне).
* `*_panel.png` — панель, вписанную в сетку 3×4 A4 (включается флагом `--debug-panel`).
* `*_3x4_A4.pptx` и/или `*_3x4_A4.pdf` — тайлы для печати с учётом полей.

### Рекомендации по параметрам

| Параметр | Назначение | Рекомендации |
| --- | --- | --- |
| `--normalize-scale`, `--normalize-blur`, `--normalize-preset` | Предварительное сглаживание исходника. Значение `default` адаптивно снижает размытие на высоком DPI, `noblur` полностью его отключает. Для хрупких деталей используйте `--normalize-preset noblur` или уменьшайте `--normalize-blur`. |
| `--threshold` и `--detail-delta` | Отделение фона и внутренних вырезов. Меньшее `detail-delta` делает серыми более светлые линии (глаза, ягоды). |
| `--dilate-px`, `--detail-join-px` | Замыкание контуров и восстановление пунктирных линий. Значения 0–1 сохраняют тонкие иголки; 2–3 помогают закрыть крупные разрывы. |
| `--antialias-radius` | Смягчение краёв перед вставкой в панель. При потере резкости уменьшайте до 0.5–0.6. |

Скрипт выводит в лог фактические значения нормализации, решения об инверсии и
эквивалентную толщину «мостиков» (1.4–2.0 мм согласно DoD). Эти цифры можно
использовать, чтобы подобрать параметры под конкретную раскраску.

### Батники для Windows

* `make_papercut_panel.bat` — интерактивный запуск в текущей папке (выбор файла,
  ввод смещений, лог в консоль и файл). Все важные флаги (`--normalize-*`,
  `--detail-*`, `--invert-mode`) прокидываются в Python-CLI.
* `make_papercut_panel_night.bat` — пакетная обработка директории рекурсивно.
  Для каждого изображения создаётся отдельная подпапка с исходником, `*_original.png`,
  PPTX и PDF.

Обе обёртки ведут журнал параметров, что облегчает контроль соответствия DoD
«качественная вытынанка».

Дальнейшее развитие: заполнить модули в `src/vyt/core/` реальным функционалом согласно ТЗ.
